<div align= "center">

![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54)![FastAPI](https://img.shields.io/badge/FastAPI-005571?style=for-the-badge&logo=fastapi)![Google Cloud](https://img.shields.io/badge/GoogleCloud-%234285F4.svg?style=for-the-badge&logo=google-cloud&logoColor=white)![Firebase](https://img.shields.io/badge/firebase-a08021?style=for-the-badge&logo=firebase&logoColor=ffcd34)![Swagger](https://img.shields.io/badge/-Swagger-%23Clojure?style=for-the-badge&logo=swagger&logoColor=white)![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)![GitHub](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white)![JWT](https://img.shields.io/badge/JWT-black?style=for-the-badge&logo=JSON%20web%20tokens)![Spotify](https://img.shields.io/badge/Spotify-1ED760?style=for-the-badge&logo=spotify&logoColor=white)

</div>

# Weather Playlists

## üé∫ Sobre o projeto

Projeto para a cria√ß√£o de uma __API__ onde o usu√°rio poder√° solicitar recomenda√ß√µes de playlists baseadas na temperatura da cidade informada.
Vi nessa proposta uma boa oportunidade para criar esse projeto utilizando o __FastAPI__, que √© amplamente recomendado pela comunidade de desenvolvedores Python, e aprofundar meus conhecimentos sobre o framework.

Projeto desenvolvido para uma avalia√ß√£o t√©cnica, ao longo da documenta√ß√£o trarei os detalhes sobre a aplica√ß√£o.

__Confira a [documenta√ß√£o da API](API.md).__

---

## üíª Tecnologias e Arquitetura

- [FastAPI](https://fastapi.tiangolo.com/)
    - O projeto foi concebido utilizando o framework FastAPI, devido sua alta performance, alta produtividade, forte tipagem e facilidade de implementa√ß√£o em ambientes Serverless.
    - O __padr√£o de design__ e a estrutura de arquivos escolhido para construir esse servi√ßo se inspira em tr√™s padr√µes: o padr√£o MVC, o padr√£o sugerido pela [documenta√ß√£o oficial](https://fastapi.tiangolo.com/tutorial/bigger-applications/) e a [sugest√£o de jankatins](https://github.com/zhanymkanov/fastapi-best-practices?tab=readme-ov-file#project-structure) inspirado no [Dispatch](https://github.com/Netflix/dispatch) da Netflix. Dessa forma, a aplica√ß√£o pode ser facilmente interpretada, atualizada e receber novas features, garantindo a __escalabilidade__ do servi√ßo.
- [Google Cloud Run](https://cloud.google.com/run/)
    - A escolha de hospedagem no Google Cloud Run se d√° pela possibilidade e facilidade de executar um ambiente serverless altamente escal√°vel, garantindo a __flexibilidade__ e __elasticidade__ dos containers e a redu√ß√£o de custos.
    - Possui cota gratu√≠ta, se tornando uma boa op√ß√£o para low-budget.
- [Google Cloud Firestore](https://cloud.google.com/firestore)
    - Utilizando o Google Cloud Firestore para armazenamento de dados, podemos facilmente instanciar uma cole√ß√£o e come√ßar a trabalhar nela de imediato, sendo uma boa op√ß√£o para garantir a __agilidade__ e n√£o precisar gastar tempo configurando um banco de dados.
    - Garante a redu√ß√£o de custos, possuindo uma cota gratu√≠ta.
- [Docker](https://www.docker.com/)
    - Apesar do Cloud Run permitir a execu√ß√£o direta da aplica√ß√£o atrav√©s do comando informado, decidi por incluir um Dockerfile, dessa forma facilita o __desacoplamento__ do GCP, podendo ser facilmente adaptado para outros servidores.
- API RESTful
    - Padr√£o para comunica√ß√£o da API, devida a sua flexibilidade e facilidade de implementa√ß√£o.

## üìé APIs externas

- [x] [Spotify](https://developer.spotify.com/)
    - API utilizada para buscar as playlists baseadas na categoria informada.
- [x] [OpenWeather](https://openweathermap.org/)
    - API utilizada para obter as coordenadas da localiza√ß√£o informada e obter as condi√ß√µes de clima.

## ‚öôÔ∏è Funcionalidades

- [x] __Usu√°rios__:
  - [x] Cria√ß√£o de usu√°rio
  - [x] Login (formul√°rio com email e senha)
    - Autentica√ß√£o atrav√©s de [JWT](https://pyjwt.readthedocs.io/en/stable/)

- [x] __Playlists__:
  - [x] Buscar playlists baseadas nas condi√ß√µes atuais de temperatura
    - Temperatura abaixo de 10¬∞C: playlist de m√∫sicas cl√°ssicas
    - Temperatura entre 10¬∞C e 25¬∞C: playlist de m√∫sicas de rock
    - Temperatura acima de 25¬∞C: playlist de m√∫sicas pop
  - [x] Consultar playlists salvas na lista de favoritos
  - [x] Salvar playlist na lista de favoritos
  - [x] Deletar playlist da lista de favoritos

## üìü Utiliza√ß√£o

Para utilizar a API o usu√°rio dever√° seguir o seguinte fluxo:
- Cria√ß√£o de usu√°rio:
    - Passando como par√¢metros: nome, email e senha.
- Autentica√ß√£o de usu√°rio:
    - Atrav√©s de email e senha, esse passo ser√° necess√°rio para informar o token nos pr√≥ximos passos.
- Consulta de playlists:
    - Consultar as playlists recomendadas a partir da localiza√ß√£o informada.
- Salvar favorito:
    - Passando como corpo da requisi√ß√£o a playlist selecionada, juntamente com a informa√ß√£o sobre o clima, retornada do passo anterior.
- Listar favoritos:
    - O usu√°rio obt√©m as playlists que salvou como favorito.
- Deletar favorito:
    - O usu√°rio pode deletar um favorito passando o ID do mesmo.

## üì¶ CI/CD (Deployment)

Para o fluxo de __CI/CD__ do projeto, utilizei algumas ferramentas:
- GitHub
    - Utilizando o __gitflow__ para gerenciar as ramifica√ß√µes e os padr√µes __sem√¢nticos__ de commits.
- Dockerfile
    - Para definir os comandos para a cria√ß√£o da imagem.
- Google Cloud Build
    - Para cria√ß√£o de __gatilhos__, nesse caso h√° um deploy sempre que houver um push na branch _main_.
- Google Cloud Run
    - Onde o _Cloud Build_ subir√° o container criado.

---

## üöÄ Como executar o projeto

### üí° Pr√©-requisitos

- [x] python3.12 (garantir os pacotes python-dev e python-venv)
- [x] pip
- [x] git
- [x] gcloud (com conta configurada no GCP)

#### üíæ Rodando local

```bash

# Clonar reposit√≥rio
$ git clone git@github.com:leandro-alvesc/weather-playlists.git

# Crie um arquivo .env de acordo com os campos contidos no arquivo .env.example
$ cat .env.example

# Crie e ative um ambiente virtual
$ python3.12 -m venv venv
$ source ./venv/bin/activate

# Instale as depend√™ncias
$ pip install -r requirements.txt

# Configure sua conta do Google Cloud, garantindo acesso ao SDK
$ gcloud init

# Garanta a autentica√ß√£o na aplica√ß√£o escolhida do gcloud
$ gcloud auth application-default login

# Execute a aplica√ß√£o em modo de desenvolvimento
$ fastapi dev app/main.py

# O servi√ßo ser√° iniciado na porta 8000
# Abra a documenta√ß√£o Swagger acessando o endpoint:
$ localhost:8000/docs

```

## ü™õ Testando

```bash

# Inicializar emulador do Firestore
$ . start_firestore_emulator.sh

# Execute o pytest
$ pytest

```

